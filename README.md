# Creating and filling the TCN DB with data.
## Термины
ТСН - Территориальные сметные нормативы
ПСМ - Проектно сметный модуль
НЦКР - Нормативы цен на комплекс работ

TON: territorial outlay normative
PNWC: price normative for work complexes
POM: project outlay module

Материалы: Глава 1
Машины: Глава 2
Оборудование: Глава 13


Ресурсная модель расчета началась с 69 дополнения.

***

## Таблица для хранения периодов.

Актуальность БД поддерживается по временным отсечкам – периодам.
Период это, копия/слепок БД на определенную дату.
Учет периодов ведется не по датам, а по нарастающим номерам, которые назначаются самостоятельно.
Таблица периодов ведется для разных категорий (сущностей):
- ТСН (кроме 13 главы.),
- Оборудование (13 глава),
- Мониторинг (актуализация текущих цен).

Период бывает двух типов: Дополнение, Индекс.

13 глава (оборудование) ведется по своим периодам.

Периоды мониторинга несут смысловую нагрузку индекса (цены).
Периоды мониторинга имеют идентичные шифры с периодами ТСН, и по смыслу привязаны к индексу.

При создании периодов ведется следующая иерархия: Текущий, Предыдущий, Родительский.
Период «Дополнение N» всегда является наследником периода «Дополнение N-1», предыдущий период тоже всегда «Дополнение N-1».
При создании нового периода «Дополнение N» из периода родителя копируются Материалы, Машины, Расценки.
В дополнении учитываются только базисные цены.
В периодах «Дополнение» текущие цены не рассчитываются и не публикуются.

Период «Индекс N» является наследником периода «Дополнение M» либо «Индекс N-1».
Предыдущий период для индекса будет либо «Индекс N-1» либо «Дополнение M».
При создании нового периода «Индекс N» формируются текущие (актуальные) цены на дату периода.

Глава 1 и 2 (Материалы/Машины) - "Ресурсы" хранятся в отдельных таблицах но синхронизируются по Основным периодам (ТСН)




***

## НЦКР
Хранится в главе 19 ТСН. Периоды ТСН.

# Порядок Экспорта данных из Postgres Normative larix

- SQLite чистая, справочники заполнены. В каталоге две головные записи для ТСН и НЦКР.
- Экспортируем таблицу из (Postgres Normative larix.period) периодов в csv файл.
- Загружаем scv файл во временную таблицу в SQLite tblRawData и переносим периоды из tblRawData в Боевую таблицу периодов tblPeriods со связями и типами.
- Задаем диапазон периодов. Записываем данные в конфиг/словарь/файл.
- Экспортируем  Расценки и Ресурсы для созданного диапазона периодов в csv файлы,
- Сохраняем имена файлов и маршруты в конфиг.

export_table_periods(csv_file: str, pgr_access: AccessData)
parsing_raw_periods(location: LocalData)
supplement_min, supplement_max = 69, 72
get_periods_range()
export_quotes_for_range_periods()
export_resource_for_range_periods()



